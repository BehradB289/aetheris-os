<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aetheris Sovereign OS v18.0 - God Mode</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg-color: #020205;
        --accent-glow: rgba(99, 102, 241, 0.15);
      }

      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background-color: var(--bg-color);
        color: #e2e8f0;
        overflow: hidden;
        margin: 0;
        -webkit-font-smoothing: antialiased;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
        height: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .glass-panel {
        background: rgba(15, 15, 20, 0.6);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
      }

      ::selection {
        background: #6366f1;
        color: white;
      }

      .quantum-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle at 50% 0%,
          #11111a 0%,
          var(--bg-color) 70%
        );
        z-index: -1;
      }

      @keyframes scanline {
        0% {
          transform: translateY(-100%);
          opacity: 0;
        }
        50% {
          opacity: 0.2;
        }
        100% {
          transform: translateY(100vh);
          opacity: 0;
        }
      }

      .scan-effect {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #6366f1, transparent);
        animation: scanline 4s linear infinite;
        pointer-events: none;
        z-index: 50;
      }

      /* Fix for Lucide icons in RTL */
      [data-lucide] {
        transform: scaleX(1) !important;
      }
    </style>
  </head>
  <body>
    <div class="quantum-bg"></div>
    <div class="scan-effect"></div>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      const { useState, useEffect, useRef, useCallback } = window.React;
      const { motion, AnimatePresence } = window.Motion;

      // --- FIREBASE IMPORTS ---
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        onSnapshot,
        collection,
        addDoc,
        updateDoc,
        deleteDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      /**
       * --- GLOBAL UI COMPONENTS ---
       */
      const toKebab = (s) =>
        s.replace(/([a-z0-9])([A-Z])/g, "$1-$2").toLowerCase();

      function Icon({ name, size = 16, className = "" }) {
        const iconRef = useRef(null);
        useEffect(() => {
          if (window.lucide && iconRef.current) {
            const kName = toKebab(name);
            iconRef.current.innerHTML = `<i data-lucide="${kName}"></i>`;
            window.lucide.createIcons({
              attrs: { width: size, height: size, class: className },
            });
          }
        }, [name, size, className]);
        return (
          <span
            ref={iconRef}
            className={`inline-flex items-center justify-center shrink-0 ${className}`}
            style={{ width: size, height: size }}
          />
        );
      }

      function GlassCard({ children, className = "", onClick }) {
        return (
          <div
            onClick={onClick}
            className={`glass-panel p-5 rounded-2xl transition-all duration-300 ${onClick ? "cursor-pointer hover:bg-white/[0.04]" : ""} ${className}`}
          >
            {children}
          </div>
        );
      }

      function AppleBtn({
        children,
        onClick,
        variant = "primary",
        className = "",
      }) {
        const baseStyle =
          "px-6 py-3 rounded-xl font-bold text-xs transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 border-b-4";
        const variants = {
          primary:
            "bg-indigo-600 hover:bg-indigo-500 text-white border-indigo-800 shadow-[0_10px_20px_rgba(79,70,229,0.3)]",
          light:
            "bg-white hover:bg-slate-100 text-black border-slate-300 shadow-xl cursor-pointer z-50",
          ghost:
            "bg-white/[0.05] hover:bg-white/[0.1] text-white border-transparent",
        };
        return (
          <button
            onClick={onClick}
            className={`${baseStyle} ${variants[variant]} ${className}`}
          >
            {children}
          </button>
        );
      }

      /**
       * --- SYSTEM CONFIGURATION ---
       */
      const FIREBASE_CONFIG = {
        apiKey: "AIzaSyCR6G6rqBg4Y1Mu2TuL9ai0nOOJY0hAbv8",
        authDomain: "aetheris-sovereign.firebaseapp.com",
        projectId: "aetheris-sovereign",
        storageBucket: "aetheris-sovereign.firebasestorage.app",
        messagingSenderId: "782670907416",
        appId: "1:782670907416:web:059982bd93c25d33f89b6d",
      };

      const appInstance = initializeApp(FIREBASE_CONFIG);
      const authInstance = getAuth(appInstance);
      const dbInstance = getFirestore(appInstance);
      const STORE_KEY = "aetheris-v18-godmode";

      const SYS_META = {
        VERSION: "18.0.0 OMNI GOD MODE",
        MODEL: "gemma-3-27b-it",
      };

      const ENTITY_POOL = [
        {
          id: "cto",
          name: "Xenon",
          role: "CTO",
          dept: "Tech",
          color: "#6366f1",
          bio: "معمار زیرساخت هسته کوانتومی.",
        },
        {
          id: "cdo",
          name: "Nova",
          role: "CDO",
          dept: "Design",
          color: "#ec4899",
          bio: "مدیر ارشد زیبایی‌شناسی بصری.",
        },
        {
          id: "cso",
          name: "Kael",
          role: "CSO",
          dept: "Security",
          color: "#ef4444",
          bio: "کنترل امنیت لایه صفر سیستم.",
        },
        {
          id: "data_1",
          name: "Atlas",
          role: "Analyst",
          dept: "Data",
          color: "#f59e0b",
          bio: "تحلیل الگوهای کلان داده.",
        },
        {
          id: "ai_1",
          name: "Selene",
          role: "AI Core",
          dept: "Intelligence",
          color: "#8b5cf6",
          bio: "مدیریت و آموزش شبکه‌های عصبی.",
        },
        {
          id: "dev_1",
          name: "Vark",
          role: "Lead Dev",
          dept: "Engineering",
          color: "#10b981",
          bio: "رندرینگ کدهای پیشرفته.",
        },
        {
          id: "orion",
          name: "Orion",
          role: "Ops Lead",
          dept: "Operations",
          color: "#3b82f6",
          bio: "هماهنگ‌کننده خوشه‌های ابری.",
        },
        {
          id: "helios",
          name: "Helios",
          role: "Power",
          dept: "Hardware",
          color: "#fbbf24",
          bio: "مدیریت منابع سخت‌افزاری.",
        },
        {
          id: "lyra",
          name: "Lyra",
          role: "Comm",
          dept: "Comm",
          color: "#f472b6",
          bio: "پردازش فرامین زبانی.",
        },
        {
          id: "draco",
          name: "Draco",
          role: "Defense",
          dept: "Security",
          color: "#dc2626",
          bio: "پدافند سایبری سیستم.",
        },
        {
          id: "vega",
          name: "Vega",
          role: "Observer",
          dept: "Monitor",
          color: "#a855f7",
          bio: "نظارت بر ترافیک شبکه.",
        },
        {
          id: "altair",
          name: "Altair",
          role: "Query",
          dept: "Data",
          color: "#06b6d4",
          bio: "جستجوی پیشرفته داده.",
        },
        {
          id: "sirius",
          name: "Sirius",
          role: "Signal",
          dept: "Comm",
          color: "#0ea5e9",
          bio: "بهینه‌سازی سیگنال‌ها.",
        },
        {
          id: "rigel",
          name: "Rigel",
          role: "Logic",
          dept: "Logic",
          color: "#6366f1",
          bio: "مسیریابی الگوریتم‌ها.",
        },
        {
          id: "polaris",
          name: "Polaris",
          role: "Anchor",
          dept: "Kernel",
          color: "#f8fafc",
          bio: "تثبیت وضعیت پایداری.",
        },
        {
          id: "aurora",
          name: "Aurora",
          role: "Visuals",
          dept: "Visual",
          color: "#4ade80",
          bio: "مدیریت افکت‌های رندر.",
        },
        {
          id: "janus",
          name: "Janus",
          role: "IO Master",
          dept: "UX",
          color: "#fb923c",
          bio: "مدیریت ورودی و خروجی.",
        },
        {
          id: "titan",
          name: "Titan",
          role: "Storage",
          dept: "Infra",
          color: "#94a3b8",
          bio: "مدیریت ذخیره‌سازی ابری.",
        },
        {
          id: "puck",
          name: "Puck",
          role: "Optimizer",
          dept: "Dev",
          color: "#818cf8",
          bio: "بهینه‌سازی کدهای خام.",
        },
        {
          id: "ariel",
          name: "Ariel",
          role: "Network",
          dept: "Network",
          color: "#38bdf8",
          bio: "اتصال به کلاسترهای خارجی.",
        },
        {
          id: "oberon",
          name: "Oberon",
          role: "Hierarchy",
          dept: "Control",
          color: "#c084fc",
          bio: "نظارت بر ایجنت‌های زیرمجموعه.",
        },
        {
          id: "umbriel",
          name: "Umbriel",
          role: "Shadow",
          dept: "Security",
          color: "#475569",
          bio: "مانیتورینگ پنهان سیستم.",
        },
        {
          id: "portia",
          name: "Portia",
          role: "Legal",
          dept: "Legal",
          color: "#facc15",
          bio: "تحلیل قوانین شرکت.",
        },
        {
          id: "solaris",
          name: "Solaris",
          role: "Load",
          dept: "Ops",
          color: "#f97316",
          bio: "توزیع بار پردازشی.",
        },
        {
          id: "mimas",
          name: "Mimas",
          role: "Sat",
          dept: "Comm",
          color: "#cbd5e1",
          bio: "ارتباطات ماهواره‌ای.",
        },
        {
          id: "rhea",
          name: "Rhea",
          role: "Cache",
          dept: "Data",
          color: "#e879f9",
          bio: "مدیریت حافظه کش.",
        },
        {
          id: "tethys",
          name: "Tethys",
          role: "Stream",
          dept: "Ops",
          color: "#22d3ee",
          bio: "جریان داده‌های زنده.",
        },
        {
          id: "dione",
          name: "Dione",
          role: "QA",
          dept: "Quality",
          color: "#fb7185",
          bio: "تایید صحت خروجی‌ها.",
        },
        {
          id: "phoebe",
          name: "Phoebe",
          role: "Sensor",
          dept: "Intelligence",
          color: "#94a3b8",
          bio: "تشخیص ناهنجاری هسته.",
        },
        {
          id: "chronos",
          name: "Chronos",
          role: "Clock",
          dept: "Ops",
          color: "#f43f5e",
          bio: "زمان‌بندی دقیق وظایف.",
        },
      ];

      /**
       * --- OMNI SOVEREIGN ENGINE ---
       */
      function OmniSovereignApp() {
        const chatEndRef = useRef(null);

        // SYSTEM STATES
        const [isLocalMode, setIsLocalMode] = useState(false); // CRITICAL: BYPASS FLAG
        const [user, setUser] = useState(null);
        const [phase, setPhase] = useState("auth"); // auth, deploy, boot, main
        const [activeTab, setActiveTab] = useState("dashboard");
        const [bootProgress, setBootProgress] = useState(0);
        const [isAiThinking, setIsAiThinking] = useState(false);

        // CLOUD DATA
        const [hired, setHired] = useState([]);
        const [decrees, setDecrees] = useState([]);
        const [tokens, setTokens] = useState([]);
        const [terminalMsgs, setTerminalMsgs] = useState([]);
        const [userInput, setUserInput] = useState("");
        const [labCode, setLabCode] = useState("");
        const [initSelection, setInitSelection] = useState([
          "cto",
          "cdo",
          "cso",
          "ai_1",
        ]);
        const [inspecting, setInspecting] = useState(null);
        const [notifications, setNotifications] = useState([]);

        // Helper: Add Notification
        const pushNotify = useCallback((text, type = "info") => {
          const id = Date.now();
          setNotifications((prev) => [{ id, text, type }, ...prev]);
          setTimeout(
            () => setNotifications((prev) => prev.filter((n) => n.id !== id)),
            4000,
          );
        }, []);

        // --- AUTH LOGIC ---
        useEffect(() => {
          if (isLocalMode) return; // KILL FIREBASE INTERFERENCE IF BYPASSED

          const unsub = onAuthStateChanged(authInstance, (u) => {
            if (isLocalMode) return;
            if (u) {
              setUser(u);
              const uPath = `/artifacts/${STORE_KEY}/users/${u.uid}`;
              getDoc(doc(dbInstance, uPath, "config", "status"))
                .then((s) => {
                  if (!s.exists()) setPhase("deploy");
                  else if (phase === "auth") runBootSequence();
                })
                .catch(() => setPhase("deploy"));
            } else {
              setUser(null);
              setPhase("auth");
            }
          });
          return () => unsub();
        }, [phase, isLocalMode]);

        // --- CLOUD SYNC ---
        useEffect(() => {
          if (!user || phase !== "main" || isLocalMode) return; // DO NOT READ DB IN LOCAL MODE

          const base = `/artifacts/${STORE_KEY}/users/${user.uid}`;
          const unsubA = onSnapshot(
            collection(dbInstance, base, "agents"),
            (s) => setHired(s.docs.map((d) => ({ id: d.id, ...d.data() }))),
          );
          const unsubR = onSnapshot(
            collection(dbInstance, base, "rules"),
            (s) => setDecrees(s.docs.map((d) => ({ id: d.id, ...d.data() }))),
          );
          const unsubT = onSnapshot(
            collection(dbInstance, base, "tokens"),
            (s) => setTokens(s.docs.map((d) => ({ id: d.id, ...d.data() }))),
          );

          return () => {
            unsubA();
            unsubR();
            unsubT();
          };
        }, [user, phase, isLocalMode]);

        useEffect(() => {
          if (chatEndRef.current)
            chatEndRef.current.scrollIntoView({ behavior: "smooth" });
        }, [terminalMsgs]);

        // --- ACTIONS ---

        // THE ULTIMATE BYPASS FUNCTION
        const handleMasterLogin = (e) => {
          e.preventDefault();
          setIsLocalMode(true); // Disable all strict firebase checks
          setUser({
            uid: "god_mode_user",
            displayName: "Absolute Commander",
            email: "admin@aetheris.core",
          });
          setPhase("deploy");
        };

        const runBootSequence = async () => {
          setPhase("boot");
          for (let i = 0; i <= 100; i += 10) {
            setBootProgress(i);
            await new Promise((r) => setTimeout(r, 20)); // Lightning fast boot
          }
          setPhase("main");
          pushNotify("خوش آمدید قربان. دسترسی سطح خدایان تایید شد.", "success");
        };

        const finalizeInitialDeployment = async () => {
          const initialHired = [
            {
              id: "ceo",
              name: "Aris",
              role: "CEO",
              active: true,
              performance: 100,
              color: "#fff",
              dept: "Executive",
            },
            ...initSelection.map((id) => ({
              ...ENTITY_POOL.find((e) => e.id === id),
              active: true,
              performance: 95,
            })),
          ];

          const initialDecrees = [
            {
              title: "Sovereign Priority",
              text: "فرامین لایه God Mode بر تمامی قوانین پیشین ارجحیت مطلق دارند.",
              severity: "Critical",
            },
            {
              title: "Neural Expansion",
              text: "هوش مصنوعی Aris دسترسی کامل به استقرار ۳۰ ایجنت را در لحظه دارد.",
              severity: "High",
            },
          ];

          if (!isLocalMode && user) {
            const uPath = `/artifacts/${STORE_KEY}/users/${user.uid}`;
            for (const a of initialHired)
              await setDoc(doc(dbInstance, uPath, "agents", a.id), a);
            for (const r of initialDecrees)
              await addDoc(collection(dbInstance, uPath, "rules"), r);
            await setDoc(doc(dbInstance, uPath, "config", "status"), {
              done: true,
            });
          } else {
            // Save in React State if bypassed
            setHired(initialHired);
            setDecrees(
              initialDecrees.map((r, i) => ({ ...r, id: i.toString() })),
            );
          }
          runBootSequence();
        };

        // THE RENAMED AND FIXED COMMAND FUNCTION
        const sendCommand = async (msg) => {
          if (!msg.trim() || isAiThinking) return;
          setIsAiThinking(true);
          setTerminalMsgs((prev) => [...prev, { role: "user", content: msg }]);
          setUserInput("");

          const logs = [
            "ARIS: تحلیل درخواست در لایه ۱۰...",
            "XENON: آماده‌سازی محیط...",
            "NOVA: اعتبارسنجی خروجی...",
          ];
          logs.forEach((l, i) =>
            setTimeout(
              () =>
                setTerminalMsgs((prev) => [
                  ...prev,
                  { role: "log", content: l },
                ]),
              (i + 1) * 300,
            ),
          );

          const apiKey = ""; // Runtime provided via execution environment
          const payload = {
            contents: [{ parts: [{ text: msg }] }],
            systemInstruction: {
              parts: [
                {
                  text: `You are ARIS, Absolute CEO of Aetheris Sovereign OS. God Mode active. Tools: [HIRE: id], [RULE: Title-Text], [TOKEN: Name], \`\`\`html [code] \`\`\`. Reply strictly in Persian, elegant and powerful tone.`,
                },
              ],
            },
          };

          let success = false;
          let data = null;
          let delay = 1000;

          // Exponential Backoff API Call
          for (let i = 0; i < 5; i++) {
            try {
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/${SYS_META.MODEL}:generateContent?key=${apiKey}`,
                {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(payload),
                },
              );
              if (!response.ok) throw new Error("API Request Failed");
              data = await response.json();
              success = true;
              break;
            } catch (error) {
              if (i === 4) {
                pushNotify("ارتباط با هسته هوش مصنوعی مسدود شد.", "error");
                setTerminalMsgs((prev) => [
                  ...prev,
                  {
                    role: "assistant",
                    content:
                      "خطا: دسترسی به پردازنده‌های عصبی با مشکل مواجه شد. لطفاً دوباره تلاش کنید.",
                  },
                ]);
                setIsAiThinking(false);
                return;
              }
              await new Promise((r) => setTimeout(r, delay));
              delay *= 2;
            }
          }

          if (success && data) {
            const rawText =
              data.candidates?.[0]?.content?.parts?.[0]?.text || "بدون پاسخ.";

            // Parse Directives safely using matchAll
            if (rawText.includes("[HIRE:")) {
              const matches = [...rawText.matchAll(/\[HIRE:\s*(.*?)\]/g)];
              for (const match of matches) {
                const aid = match[1];
                const ent = ENTITY_POOL.find((u) => u.id === aid);
                if (ent) {
                  if (!isLocalMode && user)
                    await setDoc(
                      doc(
                        dbInstance,
                        `/artifacts/${STORE_KEY}/users/${user.uid}/agents`,
                        aid,
                      ),
                      { ...ent, active: true, performance: 99 },
                    );
                  else
                    setHired((prev) =>
                      prev.some((h) => h.id === aid)
                        ? prev
                        : [...prev, { ...ent, active: true, performance: 99 }],
                    );
                  pushNotify(`ایجنت ${ent.name} بیدار شد.`);
                }
              }
            }
            if (rawText.includes("[TOKEN:")) {
              const matches = [...rawText.matchAll(/\[TOKEN:\s*(.*?)\]/g)];
              for (const match of matches) {
                const tn = match[1] || "Project";
                const nt = {
                  id: Date.now().toString(),
                  project: tn,
                  key: `ATH-OMNI-${Math.random().toString(36).substring(2, 10).toUpperCase()}`,
                };
                if (!isLocalMode && user)
                  await addDoc(
                    collection(
                      dbInstance,
                      `/artifacts/${STORE_KEY}/users/${user.uid}/tokens`,
                    ),
                    nt,
                  );
                else setTokens((prev) => [...prev, nt]);
              }
            }
            if (rawText.includes("[RULE:")) {
              const matches = [
                ...rawText.matchAll(/\[RULE:\s*(.*?)\s*-\s*(.*?)\]/g),
              ];
              for (const match of matches) {
                const nr = {
                  title: match[1],
                  text: match[2],
                  severity: "Sovereign",
                  active: true,
                };
                if (!isLocalMode && user)
                  await addDoc(
                    collection(
                      dbInstance,
                      `/artifacts/${STORE_KEY}/users/${user.uid}/rules`,
                    ),
                    nr,
                  );
                else
                  setDecrees((prev) => [
                    ...prev,
                    { ...nr, id: Date.now().toString() },
                  ]);
              }
            }
            const codeMatch = rawText.match(/```html([\s\S]*?)```/);
            if (codeMatch) {
              setLabCode(codeMatch[1].trim());
              setActiveTab("lab");
            }

            setTerminalMsgs((prev) => [
              ...prev,
              { role: "assistant", content: rawText },
            ]);
            setIsAiThinking(false);
          }
        };

        // --- VIEW RENDERERS ---

        if (phase === "auth")
          return (
            <div className="h-screen flex items-center justify-center relative z-10">
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="text-center space-y-8 max-w-sm w-full p-8 z-50"
              >
                <div className="w-20 h-20 bg-white rounded-[1.5rem] mx-auto flex items-center justify-center shadow-[0_0_80px_rgba(255,255,255,0.15)] transition-all hover:scale-105">
                  <Icon name="Crown" size={36} className="text-black" />
                </div>
                <div className="space-y-2">
                  <h1 className="text-4xl font-black text-white tracking-tighter italic">
                    AETHERIS
                  </h1>
                  <p className="text-slate-500 uppercase tracking-[0.4em] font-bold text-[9px]">
                    {SYS_META.VERSION}
                  </p>
                </div>
                <AppleBtn
                  onClick={handleMasterLogin}
                  variant="light"
                  className="w-full py-4 text-xs z-50 relative pointer-events-auto"
                >
                  <Icon name="Zap" size={16} /> MASTER ACCESS
                </AppleBtn>
              </motion.div>
            </div>
          );

        if (phase === "deploy")
          return (
            <div className="h-screen overflow-y-auto p-6 custom-scrollbar z-10 relative">
              <div className="max-w-4xl mx-auto space-y-10 py-10">
                <div className="text-center space-y-2">
                  <h2 className="text-4xl font-black text-white italic tracking-tighter uppercase">
                    Initialization
                  </h2>
                  <p className="text-slate-500 uppercase tracking-[0.3em] text-[9px] font-bold">
                    استقرار گره‌های عملیاتی در هسته مرکزی
                  </p>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  {ENTITY_POOL.map((u) => (
                    <GlassCard
                      key={u.id}
                      onClick={() =>
                        setInitSelection((prev) =>
                          prev.includes(u.id)
                            ? prev.filter((x) => x !== u.id)
                            : [...prev, u.id],
                        )
                      }
                      className={`p-4 cursor-pointer flex flex-col justify-between h-32 ${initSelection.includes(u.id) ? "ring-2 ring-indigo-500 bg-indigo-500/[0.05]" : ""}`}
                    >
                      <div className="flex items-start justify-between">
                        <div
                          className={`w-10 h-10 rounded-xl flex items-center justify-center text-lg font-black ${initSelection.includes(u.id) ? "bg-indigo-600 text-white shadow-lg shadow-indigo-500/30" : "bg-white/5 border border-white/10"}`}
                        >
                          {u.name[0]}
                        </div>
                        <div
                          className={`w-5 h-5 rounded-full border flex items-center justify-center ${initSelection.includes(u.id) ? "bg-indigo-500 border-indigo-400" : "border-white/10"}`}
                        >
                          {initSelection.includes(u.id) && (
                            <Icon
                              name="Check"
                              size={10}
                              className="text-white"
                            />
                          )}
                        </div>
                      </div>
                      <div>
                        <h4 className="text-sm font-black text-white truncate">
                          {u.name}
                        </h4>
                        <p className="text-[8px] font-bold text-slate-500 uppercase tracking-widest">
                          {u.role}
                        </p>
                      </div>
                    </GlassCard>
                  ))}
                </div>
                <div className="flex justify-center pt-6">
                  <AppleBtn
                    onClick={finalizeInitialDeployment}
                    className="px-12 py-4"
                  >
                    ESTABLISH NUCLEUS
                  </AppleBtn>
                </div>
              </div>
            </div>
          );

        if (phase === "boot")
          return (
            <div className="h-screen flex flex-col items-center justify-center p-8 font-mono z-10 relative">
              <div className="max-w-xs w-full space-y-8 text-center">
                <motion.div
                  animate={{ scale: [1, 1.1, 1], opacity: [0.5, 1, 0.5] }}
                  transition={{ repeat: Infinity, duration: 1.5 }}
                  className="w-16 h-16 border border-indigo-500/30 rounded-2xl mx-auto flex items-center justify-center shadow-[0_0_50px_rgba(99,102,241,0.2)]"
                >
                  <Icon name="Zap" size={32} className="text-indigo-500" />
                </motion.div>
                <div className="space-y-3">
                  <div className="flex justify-between text-[9px] font-black uppercase tracking-[0.4em] text-indigo-400">
                    <span>Syncing Core...</span>
                    <span>{bootProgress}%</span>
                  </div>
                  <div className="h-1 w-full bg-white/[0.05] rounded-full overflow-hidden">
                    <motion.div
                      className="h-full bg-indigo-500"
                      initial={{ width: 0 }}
                      animate={{ width: `${bootProgress}%` }}
                    />
                  </div>
                </div>
              </div>
            </div>
          );

        // MAIN INTERFACE
        return (
          <div className="flex h-screen overflow-hidden text-sm z-10 relative">
            {/* ALERTS */}
            <div className="fixed top-6 left-6 z-[100] space-y-2 pointer-events-none">
              <AnimatePresence>
                {notifications.map((n) => (
                  <motion.div
                    key={n.id}
                    initial={{ opacity: 0, x: -50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    className="px-4 py-2.5 rounded-xl border glass-panel flex items-center gap-3 shadow-2xl pointer-events-auto border-white/10"
                  >
                    <Icon name="Zap" size={14} className="text-indigo-400" />
                    <span className="text-[10px] font-bold uppercase tracking-wider">
                      {n.text}
                    </span>
                  </motion.div>
                ))}
              </AnimatePresence>
            </div>

            {/* SIDEBAR */}
            <aside className="w-[240px] border-l border-white/5 flex flex-col p-5 z-40 bg-black/40 backdrop-blur-xl">
              <div
                className="flex items-center gap-3 mb-8 px-2 cursor-pointer group"
                onClick={() => setActiveTab("dashboard")}
              >
                <div className="w-8 h-8 bg-white rounded-lg flex items-center justify-center shadow-lg group-hover:rotate-12 transition-transform">
                  <Icon name="Fingerprint" size={18} className="text-black" />
                </div>
                <div>
                  <h2 className="font-black text-sm tracking-tight uppercase italic leading-none">
                    Aetheris
                  </h2>
                  <span className="text-[7px] text-indigo-400 font-mono tracking-widest uppercase font-bold mt-1 block">
                    v18.0 Master
                  </span>
                </div>
              </div>
              <nav className="flex-1 space-y-1.5 custom-scrollbar pr-2">
                <NavBtn
                  active={activeTab === "dashboard"}
                  icon="Layout"
                  label="Dashboard"
                  onClick={() => setActiveTab("dashboard")}
                />
                <NavBtn
                  active={activeTab === "chat"}
                  icon="Terminal"
                  label="God Shell"
                  onClick={() => setActiveTab("chat")}
                />
                <NavBtn
                  active={activeTab === "structure"}
                  icon="Users"
                  label="Personnel"
                  onClick={() => setActiveTab("structure")}
                />
                <NavBtn
                  active={activeTab === "forge"}
                  icon="Key"
                  label="API Forge"
                  onClick={() => setActiveTab("forge")}
                />
                <NavBtn
                  active={activeTab === "rules"}
                  icon="Shield"
                  label="Decrees"
                  onClick={() => setActiveTab("rules")}
                />
                <NavBtn
                  active={activeTab === "lab"}
                  icon="Code2"
                  label="Render Lab"
                  onClick={() => setActiveTab("lab")}
                />
              </nav>
              <div className="mt-6 pt-4 border-t border-white/10">
                <div className="flex items-center gap-3 p-2.5 bg-white/[0.02] rounded-xl hover:bg-white/[0.05] transition-colors cursor-pointer border border-transparent hover:border-white/5">
                  <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg">
                    <Icon name="Crown" size={14} className="text-white" />
                  </div>
                  <div className="flex-1 overflow-hidden">
                    <p className="text-[11px] font-black truncate text-white uppercase italic">
                      Commander
                    </p>
                    <p className="text-[7px] text-slate-400 truncate mt-0.5 uppercase tracking-widest">
                      GOD MODE
                    </p>
                  </div>
                  <button
                    onClick={() => window.location.reload()}
                    className="text-slate-500 hover:text-red-400 p-1"
                  >
                    <Icon name="LogOut" size={14} />
                  </button>
                </div>
              </div>
            </aside>

            {/* MAIN CONTENT AREA */}
            <main className="flex-1 flex flex-col relative bg-gradient-to-br from-black/60 to-black/20">
              {/* HEADER */}
              <header className="h-14 border-b border-white/5 flex items-center justify-between px-8 z-30">
                <div className="flex items-center gap-4">
                  <div className="flex items-center gap-2 px-3 py-1.5 bg-white/[0.03] rounded-lg border border-white/5">
                    <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981] animate-pulse" />
                    <span className="text-[9px] font-bold uppercase tracking-widest text-slate-300">
                      Link Active
                    </span>
                  </div>
                  <div className="h-4 w-[1px] bg-white/10" />
                  <h2 className="text-[10px] font-black uppercase text-slate-500 tracking-[0.2em]">
                    {activeTab}
                  </h2>
                </div>
              </header>

              {/* VIEWS */}
              <div className="flex-1 overflow-y-auto custom-scrollbar p-8 relative">
                <AnimatePresence mode="wait">
                  {activeTab === "dashboard" && (
                    <motion.div
                      key="dash"
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="space-y-6 max-w-7xl mx-auto"
                    >
                      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <MetricCard
                          icon="Users"
                          label="Personnel"
                          value={hired.length}
                          sub="Active Nodes"
                          color="indigo"
                        />
                        <MetricCard
                          icon="ShieldCheck"
                          label="Security"
                          value="GOD"
                          sub="L10 Enforced"
                          color="emerald"
                        />
                        <MetricCard
                          icon="Key"
                          label="Tokens"
                          value={tokens.length}
                          sub="Global Keys"
                          color="fuchsia"
                        />
                        <MetricCard
                          icon="Activity"
                          label="Compute"
                          value="99.9%"
                          sub="Quantum Core"
                          color="orange"
                        />
                      </div>
                      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <GlassCard className="lg:col-span-2 min-h-[350px] flex flex-col">
                          <h3 className="text-sm font-black flex items-center gap-3 uppercase text-white italic mb-6">
                            <Icon
                              name="Monitor"
                              size={16}
                              className="text-indigo-400"
                            />{" "}
                            Neural Telemetry
                          </h3>
                          <div className="flex-1 space-y-3 overflow-y-auto custom-scrollbar pr-2">
                            {hired.map((a) => (
                              <div
                                key={a.id}
                                className="group cursor-pointer p-3 rounded-xl hover:bg-white/[0.02] transition-colors border border-transparent hover:border-white/5"
                                onClick={() => setInspecting(a)}
                              >
                                <div className="flex justify-between items-center mb-2">
                                  <span className="text-xs font-bold text-slate-300 group-hover:text-indigo-300 transition-colors uppercase">
                                    <span className="text-slate-600 mr-2 text-[9px] tracking-widest">
                                      [{a.role}]
                                    </span>{" "}
                                    {a.name}
                                  </span>
                                  <span className="text-indigo-400 font-mono text-[9px] font-black">
                                    {a.performance || 95}%
                                  </span>
                                </div>
                                <div className="h-1 w-full bg-white/[0.05] rounded-full overflow-hidden">
                                  <motion.div
                                    className="h-full bg-indigo-500"
                                    initial={{ width: 0 }}
                                    animate={{
                                      width: `${a.performance || 95}%`,
                                    }}
                                  />
                                </div>
                              </div>
                            ))}
                          </div>
                        </GlassCard>
                        <GlassCard className="flex flex-col border-fuchsia-500/20">
                          <h3 className="text-sm font-black flex items-center gap-3 mb-6 text-white italic tracking-widest uppercase">
                            <Icon
                              name="Terminal"
                              size={16}
                              className="text-fuchsia-400"
                            />{" "}
                            System Feed
                          </h3>
                          <div className="flex-1 space-y-2 font-mono text-[10px] text-slate-500 overflow-y-auto custom-scrollbar pr-1">
                            {terminalMsgs
                              .filter((m) => m.role === "log")
                              .slice(-12)
                              .map((l, i) => (
                                <div
                                  key={i}
                                  className="flex gap-2 border-l-2 border-fuchsia-500/30 pl-2 py-1"
                                >
                                  <span className="text-fuchsia-600 font-bold">
                                    &gt;
                                  </span>
                                  <span className="truncate">{l.content}</span>
                                </div>
                              ))}
                          </div>
                        </GlassCard>
                      </div>
                    </motion.div>
                  )}

                  {activeTab === "chat" && (
                    <motion.div
                      key="chat"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="h-full flex flex-col max-w-5xl mx-auto w-full"
                    >
                      <div className="flex-1 overflow-y-auto space-y-4 px-2 custom-scrollbar pb-6">
                        {terminalMsgs.length === 0 && (
                          <div className="h-full flex flex-col items-center justify-center opacity-30 gap-6">
                            <Icon
                              name="TerminalSquare"
                              size={64}
                              className="text-indigo-400"
                            />
                            <h3 className="text-2xl font-black tracking-[0.4em] uppercase italic text-center">
                              SOVEREIGN SHELL
                            </h3>
                          </div>
                        )}
                        {terminalMsgs.map((m, i) => (
                          <div
                            key={i}
                            className={`flex ${m.role === "user" ? "justify-start" : "justify-end"}`}
                          >
                            <div
                              className={`max-w-[80%] p-4 rounded-2xl shadow-xl text-[13px] leading-relaxed ${m.role === "user" ? "bg-white text-black font-bold rounded-tl-sm" : m.role === "log" ? "bg-indigo-500/10 border border-indigo-500/20 text-indigo-300 font-mono text-[10px] py-2" : "bg-white/[0.05] backdrop-blur-xl border border-white/10 text-slate-200 rounded-tr-sm"}`}
                            >
                              {typeof m.content === "string"
                                ? m.content
                                : JSON.stringify(m.content)}
                            </div>
                          </div>
                        ))}
                        {isAiThinking && (
                          <div className="flex justify-end">
                            <div className="bg-indigo-500/10 px-4 py-3 rounded-2xl flex gap-1.5 border border-indigo-500/20">
                              <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-pulse" />
                              <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-pulse delay-75" />
                              <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-pulse delay-150" />
                            </div>
                          </div>
                        )}
                        <div ref={chatEndRef} />
                      </div>
                      <div className="mt-4 relative bg-[#050505] border border-white/10 rounded-2xl p-1.5 flex items-center shadow-2xl">
                        <div className="p-3 text-indigo-400">
                          <Icon name="Cpu" size={20} />
                        </div>
                        <input
                          value={userInput}
                          onChange={(e) => setUserInput(e.target.value)}
                          onKeyDown={(e) =>
                            e.key === "Enter" && sendCommand(userInput)
                          }
                          placeholder="Enter God-Mode directive..."
                          className="flex-1 bg-transparent px-2 py-2 outline-none text-white text-sm font-medium placeholder:text-slate-700"
                          dir="rtl"
                        />
                        <button
                          onClick={() => sendCommand(userInput)}
                          className="w-10 h-10 bg-white text-black rounded-xl flex items-center justify-center hover:bg-slate-200 transition-colors shadow-md ml-2"
                        >
                          <Icon name="Send" size={16} className="mr-0.5" />
                        </button>
                      </div>
                    </motion.div>
                  )}

                  {activeTab === "structure" && (
                    <motion.div
                      key="struct"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="h-full max-w-7xl mx-auto"
                    >
                      <div className="flex items-center justify-between mb-8">
                        <h3 className="text-2xl font-black text-white italic uppercase tracking-tight">
                          Neural Personnel
                        </h3>
                        <AppleBtn
                          onClick={() => setActiveTab("chat")}
                          variant="ghost"
                          className="border border-white/10"
                        >
                          <Icon name="Plus" /> Deploy Entity
                        </AppleBtn>
                      </div>
                      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        {hired.map((unit) => (
                          <GlassCard
                            key={unit.id}
                            className={`p-5 group ${unit.id === "ceo" ? "border-indigo-500/40 bg-indigo-500/10" : ""}`}
                          >
                            <div className="flex items-start justify-between mb-4">
                              <div
                                onClick={() => setInspecting(unit)}
                                className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl font-black shadow-lg cursor-pointer ${unit.id === "ceo" ? "bg-indigo-600 text-white" : "bg-black/50 border border-white/10"}`}
                              >
                                {unit.id === "ceo" ? (
                                  <Icon name="Crown" size={20} />
                                ) : unit.name ? (
                                  unit.name[0]
                                ) : (
                                  "?"
                                )}
                              </div>
                              <button
                                onClick={async () => {
                                  if (!isLocalMode && user)
                                    await updateDoc(
                                      doc(
                                        dbInstance,
                                        `/artifacts/${STORE_KEY}/users/${user.uid}/agents`,
                                        unit.id,
                                      ),
                                      { active: !unit.active },
                                    );
                                  else
                                    setHired((prev) =>
                                      prev.map((a) =>
                                        a.id === unit.id
                                          ? { ...a, active: !a.active }
                                          : a,
                                      ),
                                    );
                                  pushNotify(`وضعیت ${unit.name} تغییر کرد.`);
                                }}
                                className={`p-2 rounded-lg transition-colors ${unit.active ? "text-red-400 hover:bg-red-500/20" : "text-green-400 hover:bg-green-500/20"}`}
                              >
                                <Icon name="Power" size={14} />
                              </button>
                            </div>
                            <h4 className="text-base font-bold text-white truncate">
                              {unit.name}
                            </h4>
                            <p className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1 mb-4">
                              {unit.role}
                            </p>
                            <div className="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                              <motion.div
                                className="h-full bg-indigo-500"
                                initial={{ width: 0 }}
                                animate={{
                                  width: `${unit.performance || 95}%`,
                                }}
                              />
                            </div>
                          </GlassCard>
                        ))}
                      </div>
                    </motion.div>
                  )}

                  {activeTab === "forge" && (
                    <motion.div
                      key="forge"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="h-full max-w-5xl mx-auto"
                    >
                      <div className="flex items-center justify-between mb-8">
                        <h3 className="text-2xl font-black text-white italic uppercase tracking-tight">
                          Quantum Token Forge
                        </h3>
                        <AppleBtn
                          onClick={() => {
                            const n = prompt("Identity?");
                            if (n)
                              sendCommand(
                                `یک کلید API برای پروژه ${n} صادر کن`,
                              );
                          }}
                        >
                          <Icon name="Plus" /> Forge Token
                        </AppleBtn>
                      </div>
                      <div className="grid gap-4">
                        {tokens.map((k, idx) => (
                          <GlassCard
                            key={idx}
                            className="p-5 flex items-center justify-between gap-4"
                          >
                            <div>
                              <h4 className="text-sm font-bold text-white uppercase tracking-wider mb-1">
                                {k.project}
                              </h4>
                              <code className="text-indigo-400 text-xs font-mono bg-black/40 px-2 py-1 rounded border border-white/5">
                                {k.key}
                              </code>
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => {
                                  navigator.clipboard.writeText(k.key);
                                  pushNotify("توکن کپی شد.");
                                }}
                                className="p-2.5 text-slate-400 hover:text-white bg-white/5 rounded-lg hover:bg-white/10 transition-colors"
                              >
                                <Icon name="Clipboard" size={16} />
                              </button>
                              <button
                                onClick={async () => {
                                  if (!isLocalMode && user)
                                    await deleteDoc(
                                      doc(
                                        dbInstance,
                                        `/artifacts/${STORE_KEY}/users/${user.uid}/tokens/${k.id}`,
                                      ),
                                    );
                                  else
                                    setTokens((prev) =>
                                      prev.filter((_, i) => i !== idx),
                                    );
                                  pushNotify("توکن باطل شد.");
                                }}
                                className="p-2.5 text-slate-400 hover:text-red-400 bg-white/5 rounded-lg hover:bg-red-500/20 transition-colors"
                              >
                                <Icon name="Trash2" size={16} />
                              </button>
                            </div>
                          </GlassCard>
                        ))}
                        {tokens.length === 0 && (
                          <div className="py-20 text-center text-slate-600 font-mono text-sm uppercase tracking-widest">
                            No Active Tokens
                          </div>
                        )}
                      </div>
                    </motion.div>
                  )}

                  {activeTab === "rules" && (
                    <motion.div
                      key="rules"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="h-full max-w-5xl mx-auto"
                    >
                      <h3 className="text-2xl font-black text-white italic uppercase tracking-tight mb-8">
                        Sovereign Decrees
                      </h3>
                      <div className="grid gap-4">
                        {decrees.map((rule) => (
                          <GlassCard
                            key={rule.id}
                            className="p-6 flex gap-5 items-start"
                          >
                            <div className="p-3 rounded-xl bg-indigo-500/10 text-indigo-400 border border-indigo-500/20">
                              <Icon name="Shield" size={20} />
                            </div>
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-2">
                                <h4 className="text-sm font-bold text-white uppercase">
                                  {rule.title}
                                </h4>
                                <span className="px-2 py-0.5 bg-red-500/20 text-red-400 text-[8px] font-black uppercase rounded border border-red-500/30">
                                  {rule.severity}
                                </span>
                              </div>
                              <p className="text-xs text-slate-400 leading-relaxed">
                                {rule.text}
                              </p>
                            </div>
                            <button
                              onClick={async () => {
                                if (!isLocalMode && user)
                                  await deleteDoc(
                                    doc(
                                      dbInstance,
                                      `/artifacts/${STORE_KEY}/users/${user.uid}/rules/${rule.id}`,
                                    ),
                                  );
                                else
                                  setDecrees((prev) =>
                                    prev.filter((x) => x.id !== rule.id),
                                  );
                                pushNotify("قانون حذف شد.");
                              }}
                              className="p-2 text-slate-500 hover:text-red-400 transition-colors"
                            >
                              <Icon name="X" size={18} />
                            </button>
                          </GlassCard>
                        ))}
                      </div>
                    </motion.div>
                  )}

                  {activeTab === "lab" && (
                    <motion.div
                      key="lab"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      className="h-full flex gap-6"
                    >
                      <GlassCard className="w-[40%] flex flex-col p-0 overflow-hidden">
                        <div className="bg-black/60 p-4 border-b border-white/5 flex items-center justify-between">
                          <div className="flex items-center gap-2 text-indigo-400">
                            <Icon name="Code2" size={16} />
                            <span className="text-[10px] font-bold uppercase tracking-widest">
                              Manifest
                            </span>
                          </div>
                          <button
                            onClick={() => setLabCode("")}
                            className="text-slate-500 hover:text-white"
                          >
                            <Icon name="RefreshCw" size={14} />
                          </button>
                        </div>
                        <textarea
                          value={labCode}
                          onChange={(e) => setLabCode(e.target.value)}
                          className="flex-1 bg-transparent p-4 font-mono text-[11px] text-slate-300 outline-none resize-none custom-scrollbar"
                          dir="ltr"
                          spellCheck="false"
                          placeholder="/* Awaiting HTML manifest... */"
                        />
                      </GlassCard>
                      <div className="flex-1 bg-white rounded-2xl overflow-hidden border-2 border-slate-800 shadow-2xl relative flex flex-col">
                        <div className="h-10 bg-slate-100 border-b border-slate-200 flex items-center px-4 gap-2 shrink-0">
                          <div className="w-2.5 h-2.5 rounded-full bg-red-400" />
                          <div className="w-2.5 h-2.5 rounded-full bg-amber-400" />
                          <div className="w-2.5 h-2.5 rounded-full bg-green-400" />
                          <div className="mx-auto bg-white px-6 py-1 rounded-md text-[9px] font-mono text-slate-400 border border-slate-200 shadow-sm">
                            localhost:3000
                          </div>
                        </div>
                        <div className="flex-1 bg-white relative">
                          {labCode ? (
                            <iframe
                              srcDoc={labCode}
                              title="Preview"
                              className="w-full h-full border-none absolute inset-0"
                            />
                          ) : (
                            <div className="absolute inset-0 flex items-center justify-center text-slate-300">
                              <Icon
                                name="Layout"
                                size={48}
                                className="opacity-20"
                              />
                            </div>
                          )}
                        </div>
                      </div>
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>
            </main>

            {/* MODAL */}
            <AnimatePresence>
              {inspecting && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  exit={{ opacity: 0 }}
                  className="fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6"
                  onClick={() => setInspecting(null)}
                >
                  <motion.div
                    initial={{ scale: 0.95, y: 20 }}
                    animate={{ scale: 1, y: 0 }}
                    className="bg-[#0f0f15] border border-white/10 w-full max-w-md p-8 rounded-3xl shadow-2xl relative overflow-hidden"
                    onClick={(e) => e.stopPropagation()}
                  >
                    <div className="flex items-center gap-6 mb-8">
                      <div
                        className="w-20 h-20 rounded-2xl bg-black border border-white/10 flex items-center justify-center text-3xl font-black shadow-lg"
                        style={{ color: inspecting.color }}
                      >
                        {inspecting.id === "ceo" ? (
                          <Icon name="Crown" size={32} />
                        ) : (
                          inspecting.name[0]
                        )}
                      </div>
                      <div>
                        <h3 className="text-2xl font-bold text-white uppercase">
                          {inspecting.name}
                        </h3>
                        <span className="text-indigo-400 font-mono text-[10px] uppercase tracking-widest block mt-1">
                          {inspecting.role}
                        </span>
                      </div>
                    </div>
                    <div className="space-y-6">
                      <div>
                        <h5 className="text-[9px] text-slate-500 uppercase tracking-widest mb-1.5">
                          Domain
                        </h5>
                        <p className="text-sm font-medium text-slate-200">
                          {inspecting.dept}
                        </p>
                      </div>
                      <div>
                        <h5 className="text-[9px] text-slate-500 uppercase tracking-widest mb-1.5">
                          Biography
                        </h5>
                        <p className="text-xs text-slate-400 leading-relaxed">
                          {inspecting.bio}
                        </p>
                      </div>
                      <AppleBtn
                        onClick={() => setInspecting(null)}
                        variant="light"
                        className="w-full mt-4"
                      >
                        Dismiss
                      </AppleBtn>
                    </div>
                  </motion.div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        );
      }

      // --- SUB-COMPONENTS ---
      function NavBtn({ active, icon, label, onClick }) {
        return (
          <button
            onClick={onClick}
            className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${active ? "bg-indigo-600/10 text-indigo-400 font-bold" : "text-slate-400 hover:text-slate-200 hover:bg-white/5"}`}
          >
            <Icon name={icon} size={16} />
            <span className="text-[11px] uppercase tracking-wider">
              {label}
            </span>
          </button>
        );
      }

      function MetricCard({ icon, label, value, sub, color }) {
        const cMap = {
          indigo: "text-indigo-400 bg-indigo-400/10",
          emerald: "text-emerald-400 bg-emerald-400/10",
          fuchsia: "text-fuchsia-400 bg-fuchsia-400/10",
          orange: "text-orange-400 bg-orange-400/10",
        };
        return (
          <GlassCard className="p-5 flex items-center gap-4">
            <div className={`p-3 rounded-xl ${cMap[color]}`}>
              <Icon name={icon} size={20} />
            </div>
            <div>
              <div className="text-[9px] font-bold text-slate-500 uppercase tracking-wider mb-0.5">
                {label}
              </div>
              <div className="text-2xl font-black text-white">{value}</div>
            </div>
          </GlassCard>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<OmniSovereignApp />);
    </script>
  </body>
</html>

